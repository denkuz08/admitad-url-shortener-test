# admitad-url-shortener-test

Тестовое задание для Admitad

---

После развертывания проекта:

- Настроить .env
- Запустить `bin/console doctrine:migrations:migrate`
- Запустить сервер (можно ипользовать тот, что предлагает symfony - `symfony server:start`)

После миграций произойдет следующее:

- Будут созданы таблицы user и url
- Будет добавлено два пользователя в таблицу user:

| login | api_token |
| --- | --- |
| test_user1 | 12c1480dcaa94584ed5ef87ff8ecb855 |
| test_user2 | c0fea7aaf4d6d1243f584c003ad5b1d3 |


- Будет добавлена одна ссылка в таблицу url:

| created_user_id | url | short_code | created_at |
| --- | --- | --- | --- |
| 1 | https://google.com/ | ggl | 2021-04-29 |


## API:

Для авторизации нужно передать заголовок `API-TOKEN` с токеном пользователя в значении

1. `GET /api/user/me` - отдает информацию о текущем авторизованном по токену пользователе

2. `POST /api/url/create` - создание новой короткой ссылки
 
Для создания новой короткой ссылки нужно сделать POST-запрос на /api/url/create c JSON'ом:

```js
{
  "url": "https://google.com/", // ссылка с протоколом http, https или ftp
  "short_code": "ggl" // Необязательно, сделано для возможности создавать "красивые ссылки"
}
```

Ответ на успешное создание короткой ссылки примерно такой:

```js
{
  "url": "https://google.com/",
  "short_code": "ggl",
  "short_url": "http://127.0.0.1:8000/u/ggl"
}
```

Можно перейти по ссылке, указанной в short_url , должен произойти редирект

3. `GET /api/stats?user_id=1&date_from=2021-04-01&date_to=2021-05-01&group_by=date`

Все параметры необязательные

Описание параметров:

- `user_id` - Идентификатор пользователя из базы. Выступает фильтром по пользователю. Принимает одно значение - число. Если пользователь не найден, API вернет ошибку. Если не передано, то в выборку попадают все пользователи
- `date_from` - Дата, с которой считать количество созданных ссылок. Ссылки будут отфильтрованы по полю `created_at`. Если не передано, то либо принимает дефолтное значение "-одна неделя от текущего дня"
- `date_to` - Дата, по которую считать количество созданных ссылок. Ссылки будут отфильтрованы по полю `created_at`. Если не передано, то дефолтное значение "сегодня". Если `date_from` > `date_to`, то под капотом они поменяются местами 
- `group_by` - Как группировать данные. Возможные значения - `date` (только по дате), `user` (только по пользователю), `user_date` (по пользователю и дате). Если не передано, то по умолчанию группировка по пользователю

## Переход по сгенерированным ссылкам

Происходит по адресу `/u/{short_code}` (где `{short_code}` - это сгенерированный короткий код ссылки)

Например, после развертывания приложения, можно будет перейти на `/u/ggl`, произойдет редирект на https://google.com/

---

Переход по ссылкам, не предусмотренным в приложении, должен приводить к редиректу на главную
